## Try Hack me [ http level 3 ]

| –°–æ–±—ã—Ç–∏–µ | –ù–∞–∑–≤–∞–Ω–∏–µ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
| :------ | ---- | ---- | ---- |
| VKACTF 2022 | Try Hack me [ http level 3 ] | Web | Hard |

### –û–ø–∏—Å–∞–Ω–∏–µ

> –ê–≤—Ç–æ—Ä: [ ùïÇùï£ùïíùï¶ùï§ùïñ ]
>
> –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤–∑–ª–æ–º–∞–ª–∏ —Å–∞–π—Ç –ö–∏–±–µ—Ä—Å–ª–∞–≤–∞, –æ–Ω–∏ —Ä–∞–∑–º–µ—Å—Ç–∏–ª–∏ —Å–≤–æ—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–æ–≤—ã–µ [—Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã](https://www.cloudflare.com/learning/performance/what-is-http3/). –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∞–π—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É!

### –£—è–∑–≤–∏–º–æ—Å—Ç—å

> [Leaking uninitialized memory from H2O Web Server](https://medium.com/@emil.lerner/leaking-uninitialized-memory-from-fastly-83327bcbee1f)

### –†–µ—à–µ–Ω–∏–µ
> –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —É –º–µ–Ω—è –Ω–µ –≤—ã—à–ª–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–∞–∫, —á—Ç–æ–±—ã —Å –Ω–∏–º –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è –±—Ä–∞—É–∑–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–¥–Ω–∞–∫–æ, cURl —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º http3 –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —ç—Ç–æ–π –∑–∞–¥–∞—á–µ–π.

–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–π—Ç–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å. –û–¥–Ω–∞–∫–æ, —Ç–∞–∫ –∫–∞–∫ –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ —É –Ω–∞—Å –Ω–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã—Ö –∫–æ–¥–æ–≤, —Ç–æ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∞–∑–≤–µ–¥–∫—É. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ —Å–∫—Ä—ã—Ç—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –Ω–µ –ø–æ–¥–æ–π–¥—É—Ç, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±—â–∞–µ—Ç—Å—è –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É `HTTP/3`

### –†–∞–∑–≤–µ–¥–∫–∞

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
```bash
#!/bin/bash

URL=https://<URL>
dict=/tmp/quickhits.txt

while read -r line; do
        timeout 1 curl -I -s --http3 $URL$line | grep 'HTTP/3 200' 1>/dev/null && echo "[+] Found path $line"
done <$dict
```

> –í–æ–∑–º–æ–∂–Ω–æ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ, –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–∏—Å–∫–∞ —Å–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤, –Ω–æ —è –∏—Ö –Ω–µ –Ω–∞—à—ë–ª

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–≤–∞—Ä—è –±—É–¥—É—Ç –Ω–∞–π–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã

![](images/fuzz.jpg)

–ò—Å—Ö–æ–¥—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ `Dockerfile`'–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ `python` –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `app` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `h2o`

–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å–µ—Ä–µ–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –ø–æ–∫–∞–∑–∞–Ω–æ, –Ω–æ –µ–≥–æ –Ω–µ —Ç—Ä—É–¥–Ω–æ —É–∑–Ω–∞—Ç—å - `main.py` (/home/h2o/app/main.py)

–°–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π `admin` –∏ `default`). –ü–æ—Å–ª–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è logger, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ post-–¥–∞–Ω–Ω—ã–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –Ω–∞ `/log`

–ü—É—Ç—å `/admin` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–ª–∞–≥ –∏ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞.

–ò–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ h2o —Å–µ—Ä–≤–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏

![](images/header.jpg)

–î–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è [—É—è–∑–≤–∏–º–∞](https://medium.com/@emil.lerner/leaking-uninitialized-memory-from-fastly-83327bcbee1f) –¥–ª—è –∞—Ç–∞–∫–∏ `Leaking uninitialized memory from H2O Web Server`

### –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è

–î–∞–Ω–Ω–æ–π —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä `CVE-2021‚Äì43848`. [PoC](https://github.com/neex/hui2ochko) –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ

–≠–∫—Å–ø–ª–æ–π—Ç –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–∞—Å—Ç—å —Å–≤–æ–µ–π –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –≤ POST –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—É—Ç—å

–í —ç–∫—Å–ø–ª–æ–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å `/api/log/` –∏ –∫—É–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –ª–∏–∫–Ω—É—Ç–∞—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–ø–∏—Å—ã–≤–∞–ª–∞—Å—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ª–æ–≥ —Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (md5sum –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

![](images/exploit.jpg)

–õ–æ–≥–∏ —ç–∫—Å–ø–ª–æ–π—Ç–∞ –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ —Ñ–∞–π–ª –ø–æ –ø—É—Ç–∏ `/app/logs/(md5sum –æ—Ç username).log` –∏ —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç .1 –¥–æ .9

–ù–∞ –ø—É—Ç—å `/admin` –µ–∂–µ—Å–µ–∫—É–Ω–¥–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞–ø—Ä–æ—Å—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö –∫–æ–¥–æ–≤). –û—Ç–≤–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤ –ª–æ–≥–∞—Ö —ç–∫—Å–ø–ª–æ–π—Ç–∞ –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–≤–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–≠–∫—Å–ø–ª–æ–π—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, –ø–æ–∫–∞ –≤ –ª–æ–≥–∞—Ö –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è —Ñ–ª–∞–≥

```bash
while :; do ./hui2ochko <DNS> <IP>; done
```

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ —Ñ–ª–∞–≥–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π bash —Å–∫—Ä–∏–ø—Ç

```bash
while :;
do
    check_flag=0
    for i in {1..9}
    do
        docker run -it --rm ymuski/curl-http3 curl --http3 "$URL/app/logs/$(echo -n $USERNAME | md5sum | cut -c 1-32).log.$i" | tr -d 'A' | grep vka && exit
    done
    sleep 60
done
```

**–§–ª–∞–≥:**

> vka{l34k1n6_un1n1714l1z3d_m3m0ry_fr0m_h20_w3b_53rv3r}